---
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";

const posts = await getCollection("blog");
const sortedPosts = posts.sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

// Get featured posts (first 3)
const featuredPosts = sortedPosts.slice(0, 3);
const editorsPicks = sortedPosts.slice(3, 7);
// Show all posts in Latest section
const latestPosts = sortedPosts;

// SEO optimizations
const seoTitle = "Jessica Things - Blog de Beleza, Moda e Estilo de Vida";
const seoDescription =
	"Descubra as últimas tendências em beleza, moda e estilo de vida no Jessica Things. Dicas exclusivas, reviews de produtos e inspiração diária para mulheres modernas.";

// Structured data for homepage
const structuredData = {
	"@context": "https://schema.org",
	"@type": "Blog",
	name: "Jessica Things",
	description: seoDescription,
	url: Astro.site?.toString(),
	author: {
		"@type": "Person",
		name: "Jessica",
	},
	publisher: {
		"@type": "Organization",
		name: "Jessica Things",
		logo: {
			"@type": "ImageObject",
			url: new URL("/favicon.svg", Astro.site).toString(),
		},
	},
	blogPost: featuredPosts.map((post) => ({
		"@type": "BlogPosting",
		headline: post.data.title,
		description: post.data.description,
		url: new URL(post.slug, Astro.site).toString(),
		datePublished: new Date(post.data.date).toISOString(),
		author: {
			"@type": "Person",
			name: "Jessica",
		},
	})),
};
---

<BaseLayout title={seoTitle} description={seoDescription} structuredData={structuredData}>
	<div class="min-h-screen bg-white">
		<!-- Header -->
		<header class="sticky top-0 z-50 border-b border-gray-200 bg-white shadow-sm">
			<div class="container mx-auto px-4 py-4">
				<div class="flex items-center justify-between">
					<div class="flex items-center space-x-2 md:space-x-4">
						<a href="/" class="text-2xl font-bold text-gray-900 md:text-3xl">Jessica Things</a>
						<span class="hidden text-sm text-gray-500 sm:inline">Beleza, Moda & Estilo de Vida</span
						>
					</div>

					<!-- Desktop Navigation -->
					<nav class="hidden space-x-6 md:flex">
						<a href="/" class="font-medium text-gray-900">Início</a>
						<a href="/explorar" class="text-gray-700 transition-colors hover:text-gray-900"
							>Explorar</a
						>
						<a href="/categories" class="text-gray-700 transition-colors hover:text-gray-900"
							>Categorias</a
						>
						<a href="/tags" class="text-gray-700 transition-colors hover:text-gray-900">Tags</a>
					</nav>

					<!-- Mobile Menu Button -->
					<button
						id="mobile-menu-btn"
						class="flex items-center justify-center rounded-lg p-2 text-gray-700 transition-colors hover:bg-gray-100 md:hidden"
						aria-label="Toggle menu"
					>
						<svg
							id="menu-icon"
							class="h-6 w-6"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M4 6h16M4 12h16M4 18h16"></path>
						</svg>
						<svg
							id="close-icon"
							class="hidden h-6 w-6"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M6 18L18 6M6 6l12 12"></path>
						</svg>
					</button>
				</div>

				<!-- Mobile Navigation -->
				<nav id="mobile-menu" class="hidden overflow-hidden md:hidden">
					<div class="space-y-1 pb-3 pt-4">
						<a
							href="/"
							class="block rounded-lg bg-gray-100 px-3 py-2 text-base font-medium text-gray-900"
						>
							Início
						</a>
						<a
							href="/explorar"
							class="block rounded-lg px-3 py-2 text-base font-medium text-gray-700 transition-colors hover:bg-gray-100 hover:text-gray-900"
						>
							Explorar
						</a>
						<a
							href="/categories"
							class="block rounded-lg px-3 py-2 text-base font-medium text-gray-700 transition-colors hover:bg-gray-100 hover:text-gray-900"
						>
							Categorias
						</a>
						<a
							href="/tags"
							class="block rounded-lg px-3 py-2 text-base font-medium text-gray-700 transition-colors hover:bg-gray-100 hover:text-gray-900"
						>
							Tags
						</a>
					</div>
				</nav>
			</div>
		</header>

		<main class="container mx-auto px-4 py-6 md:py-8">
			<!-- Hero Section -->
			<section class="mb-12 md:mb-16">
				<div class="grid grid-cols-1 items-center gap-6 md:gap-8 lg:grid-cols-2">
					<div>
						<h2 class="mb-3 text-3xl font-bold text-gray-900 md:mb-4 md:text-5xl">
							Descubra Seu Estilo
						</h2>
						<p class="mb-4 text-base text-gray-600 md:mb-6 md:text-xl">
							Explore o que há de mais novo em beleza, moda e estilo de vida com Jessica Things. Sua
							fonte de dicas, resenhas e inspiração.
						</p>
						<a
							href="/explorar"
							class="rounded-full bg-black px-8 py-3 text-white transition-colors hover:bg-gray-800"
						>
							Explorar Posts
						</a>
					</div>
					<div class="relative">
						{
							featuredPosts[0] && (
								<div class="relative overflow-hidden rounded-lg">
									<img
										src={featuredPosts[0].data.thumbnail || "/placeholder-image.jpg"}
										alt={featuredPosts[0].data.title}
										class="h-96 w-full object-cover"
									/>
									<div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-6">
										<div class="mb-2 flex items-center space-x-2">
											<span class="rounded bg-white px-2 py-1 text-xs font-medium text-black">
												{featuredPosts[0].data.categories?.[0] || "BLOG"}
											</span>
											<span class="text-sm text-white">
												{new Date(featuredPosts[0].data.date).toLocaleDateString("pt-BR", {
													month: "short",
													day: "numeric",
													year: "numeric",
												})}
											</span>
										</div>
										<h3 class="mb-2 text-xl font-bold text-white">
											<a href={`/${featuredPosts[0].slug}`} class="hover:underline">
												{featuredPosts[0].data.title}
											</a>
										</h3>
										<p class="line-clamp-2 text-sm text-gray-200">
											{featuredPosts[0].data.excerpt || featuredPosts[0].data.description}
										</p>
									</div>
								</div>
							)
						}
					</div>
				</div>
			</section>

			<!-- Editor's Pick -->
			<section class="mb-12 md:mb-16">
				<div class="mb-6 flex items-center justify-between md:mb-8">
					<h2 class="text-2xl font-bold text-gray-900 md:text-3xl">Escolha do Editor</h2>
					<a href="/explorar" class="text-sm text-black hover:underline md:text-base">Ver Todos</a>
				</div>
				<div class="grid grid-cols-1 gap-6 sm:grid-cols-2 md:gap-8 lg:grid-cols-3">
					{
						editorsPicks.map((post) => (
							<article class="group">
								<div class="relative mb-4 overflow-hidden rounded-lg">
									<img
										src={
											post.data.thumbnail ||
											(post.data.ogImage as unknown as string) ||
											"/placeholder-image.jpg"
										}
										alt={post.data.title}
										class="h-48 w-full object-cover transition-transform duration-300 group-hover:scale-105"
									/>
									<div class="absolute left-4 top-4">
										<span class="rounded bg-black px-3 py-1 text-xs font-medium text-white">
											{post.data.categories?.[0] || "BLOG"}
										</span>
									</div>
								</div>
								<div class="space-y-2">
									<span class="text-sm text-gray-500">
										{new Date(post.data.date).toLocaleDateString("pt-BR", {
											month: "short",
											day: "numeric",
											year: "numeric",
										})}
									</span>
									<h3 class="line-clamp-2 text-xl font-bold text-gray-900">
										<a href={`/${post.slug}`} class="hover:underline">
											{post.data.title}
										</a>
									</h3>
									<p class="line-clamp-2 text-sm text-gray-600">
										{post.data.excerpt || post.data.description}
									</p>
									<a
										href={`/${post.slug}`}
										class="inline-flex items-center text-sm font-medium text-black hover:underline"
									>
										LEIA MAIS
										<svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M17 8l4 4m0 0l-4 4m4-4H3"
											/>
										</svg>
									</a>
								</div>
							</article>
						))
					}
				</div>
			</section>

			<!-- Latest Posts - All Content -->
			<section class="mb-12 md:mb-16">
				<div class="mb-6 flex items-center justify-between md:mb-8">
					<h2 class="text-2xl font-bold text-gray-900 md:text-3xl">Mais Recentes</h2>
					<span class="text-xs text-gray-500 md:text-sm">{latestPosts.length} posts</span>
				</div>
				<div class="grid grid-cols-1 gap-4 sm:grid-cols-2 sm:gap-6 lg:grid-cols-3 xl:grid-cols-4">
					{
						latestPosts.map((post) => (
							<article class="group overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm transition-shadow duration-300 hover:shadow-md">
								<div class="relative overflow-hidden">
									<img
										src={post.data.thumbnail || "/placeholder-image.jpg"}
										alt={post.data.title}
										class="h-48 w-full object-cover transition-transform duration-300 group-hover:scale-105"
									/>
									<div class="absolute left-3 top-3">
										<span class="rounded bg-black px-2 py-1 text-xs font-medium text-white">
											{post.data.categories?.[0] || "BLOG"}
										</span>
									</div>
								</div>
								<div class="space-y-2 p-4">
									<div class="text-xs text-gray-500">
										{new Date(post.data.date).toLocaleDateString("pt-BR", {
											month: "short",
											day: "numeric",
											year: "numeric",
										})}
									</div>
									<h3 class="line-clamp-2 text-sm font-bold text-gray-900">
										<a href={`/${post.slug}`} class="hover:underline">
											{post.data.title}
										</a>
									</h3>
									<p class="line-clamp-2 text-xs text-gray-600">
										{post.data.excerpt || post.data.description}
									</p>
								</div>
							</article>
						))
					}
				</div>

				<!-- Load More Button (optional) -->
				<div class="mt-12 text-center">
					<button
						id="loadMoreBtn"
						class="hidden rounded-full bg-black px-8 py-3 text-white transition-colors hover:bg-gray-800"
					>
						Carregar Mais Posts
					</button>
				</div>
			</section>
		</main>

		<!-- Footer -->
		<footer class="border-t border-gray-200 bg-gray-50">
			<div class="container mx-auto px-4 py-12">
				<div class="grid grid-cols-1 gap-8 md:grid-cols-4">
					<div>
						<h3 class="mb-4 text-lg font-bold text-gray-900">Jessica Things</h3>
						<p class="text-sm text-gray-600">
							Sua fonte de inspiração para beleza, moda e estilo de vida.
						</p>
					</div>
					<div>
						<h4 class="mb-4 text-sm font-semibold text-gray-900">Categorias</h4>
						<ul class="space-y-2 text-sm text-gray-600">
							<li><a href="/category/beauty" class="hover:text-gray-900">Beleza</a></li>
							<li><a href="/category/fashion" class="hover:text-gray-900">Moda</a></li>
							<li><a href="/category/lifestyle" class="hover:text-gray-900">Estilo de Vida</a></li>
						</ul>
					</div>
					<div>
						<h4 class="mb-4 text-sm font-semibold text-gray-900">Siga-nos</h4>
						<ul class="space-y-2 text-sm text-gray-600">
							<li>
								<a href="https://www.instagram.com/jessicatthings_" class="hover:text-gray-900"
									>Instagram</a
								>
							</li>
							<li>
								<a href="https://www.youtube.com/@JessicaThings_" class="hover:text-gray-900"
									>YouTube</a
								>
							</li>
							<li>
								<a href="https://www.tiktok.com/@jessicatthings_" class="hover:text-gray-900"
									>TikTok</a
								>
							</li>
						</ul>
					</div>
					<div>
						<h4 class="mb-4 text-sm font-semibold text-gray-900">Newsletter</h4>
						<p class="mb-4 text-sm text-gray-600">Receba as últimas atualizações</p>
						<form class="flex">
							<input
								type="email"
								placeholder="Seu e-mail"
								class="flex-1 rounded-l border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black"
							/>
							<button
								type="submit"
								class="rounded-r bg-black px-4 py-2 text-white transition-colors hover:bg-gray-800"
							>
								Inscrever
							</button>
						</form>
					</div>
				</div>
				<div class="mt-8 border-t border-gray-200 pt-8 text-center text-sm text-gray-600">
					<p>&copy; 2025 Jessica Things. Todos os direitos reservados.</p>
				</div>
			</div>
		</footer>
	</div>
</BaseLayout>

<script>
	// Mobile menu toggle
	const mobileMenuBtn = document.getElementById("mobile-menu-btn");
	const mobileMenu = document.getElementById("mobile-menu");
	const menuIcon = document.getElementById("menu-icon");
	const closeIcon = document.getElementById("close-icon");

	mobileMenuBtn?.addEventListener("click", () => {
		const isHidden = mobileMenu?.classList.contains("hidden");

		if (isHidden) {
			mobileMenu?.classList.remove("hidden");
			menuIcon?.classList.add("hidden");
			closeIcon?.classList.remove("hidden");
		} else {
			mobileMenu?.classList.add("hidden");
			menuIcon?.classList.remove("hidden");
			closeIcon?.classList.add("hidden");
		}
	});

	// Close mobile menu when clicking outside
	document.addEventListener("click", (e) => {
		const target = e.target;
		if (target instanceof Element) {
			if (!target.closest("#mobile-menu-btn") && !target.closest("#mobile-menu")) {
				mobileMenu?.classList.add("hidden");
				menuIcon?.classList.remove("hidden");
				closeIcon?.classList.add("hidden");
			}
		}
	});
</script>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	/* Responsive adjustments */
	@media (max-width: 768px) {
		.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3.xl\:grid-cols-4 {
			grid-template-columns: repeat(1, minmax(0, 1fr));
		}
	}

	@media (min-width: 769px) and (max-width: 1024px) {
		.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3.xl\:grid-cols-4 {
			grid-template-columns: repeat(2, minmax(0, 1fr));
		}
	}

	@media (min-width: 1025px) and;
</style>
